# Railway Deployment Guide

This guide will help you deploy the Tire CRM application to Railway with your local database intact.

## 1. Prerequisites

- [Railway Account](https://railway.app/)
- [Railway CLI](https://docs.railway.app/guides/cli) installed (`npm i -g @railway/cli`)
- Git repository pushed to GitHub

## 2. Project Setup on Railway

1.  **Create a New Project** on Railway.
2.  **Add Database**:
    *   Click "New" -> "Database" -> "PostgreSQL".
    *   This will be your production database.
3.  **Add Redis**:
    *   Click "New" -> "Database" -> "Redis".
4.  **Deploy Backend**:
    *   Click "New" -> "GitHub Repo".
    *   Select this repository.
    *   **Configuration**:
        *   **Root Directory**: `backend`
        *   **Variables**:
            *   `DATABASE_URL`: (Use the variable reference from your Postgres service, e.g., `${{Postgres.DATABASE_URL}}`)
            *   `REDIS_URL`: (Use the variable reference from your Redis service, e.g., `${{Redis.REDIS_URL}}`)
            *   `PORT`: `3001`
            *   `JWT_SECRET`: (Set a secure secret)
            *   `CORS_ORIGIN`: `https://<your-frontend-url>.up.railway.app` (You'll get this URL after deploying frontend)
5.  **Deploy Frontend**:
    *   Click "New" -> "GitHub Repo" (Select the same repo again).
    *   **Configuration**:
        *   **Root Directory**: `frontend`
        *   **Variables**:
            *   `NEXT_PUBLIC_BACKEND_URL`: `https://<your-backend-url>.up.railway.app`
            *   `NEXT_PUBLIC_GRAPHQL_URL`: `https://<your-backend-url>.up.railway.app/graphql`

## 3. Migrating Your Local Database

We have created a script to help you migrate your local data to Railway.

1.  **Backup Local Data**:
    Run the migration script from your project root:
    ```bash
    ./scripts/railway-migration.sh
    ```
    This will create a SQL dump file in the `backups/` directory.

2.  **Restore to Railway**:
    *   Login to Railway CLI: `railway login`
    *   Link your project: `railway link` (Select your project)
    *   Pipe the backup to the Railway database:
        ```bash
        cat backups/tire_crm_backup_<TIMESTAMP>.sql | railway connect --service postgres
        ```
        *(Replace `<TIMESTAMP>` with the actual filename generated by the script)*

## 4. Final Steps

1.  Once the database is restored, redeploy the Backend service to ensure Prisma picks up any schema changes (though the dump should handle it).
2.  Update the `CORS_ORIGIN` in your Backend service variables to match your Frontend's public URL.
3.  Update the `NEXT_PUBLIC_BACKEND_URL` in your Frontend service variables to match your Backend's public URL.

Your application should now be live with your local data!
