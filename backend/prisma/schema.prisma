// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountType {
  INDIVIDUAL
  LARGE_ACCOUNT
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
}

enum CommunicationMethod {
  EMAIL
  SMS
  PHONE
  ALL
}

enum EmployeeRole {
  MANAGER
  SERVICE_ADVISOR
  ACCOUNT_MANAGER
  TECHNICIAN
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
}

enum ReminderStatus {
  PENDING
  SENT
  DISMISSED
  CONVERTED
}

enum TransactionType {
  SALE
  REFUND
  ADJUSTMENT
}

enum LargeAccountType {
  COMMERCIAL
  FLEET
  ENTERPRISE
}

enum LargeAccountTier {
  SILVER
  GOLD
  PLATINUM
}

enum LargeAccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  TERMINATED
}

enum ServiceLevel {
  STANDARD
  ENHANCED
  PREMIUM
}

model Customer {
  id                    String            @id @default(cuid())
  firstName             String            @db.VarChar(50)
  lastName              String            @db.VarChar(50)
  email                 String?           @unique @db.VarChar(255)
  phone                 String            @db.VarChar(20)
  address               String?           @db.VarChar(200)
  city                  String?           @db.VarChar(50)
  state                 String?           @db.VarChar(20)
  zipCode               String?           @db.VarChar(10)
  accountType           AccountType       @default(INDIVIDUAL)
  status                CustomerStatus    @default(ACTIVE)
  preferredCommunication CommunicationMethod @default(EMAIL)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  // Relationships
  vehicles              Vehicle[]
  appointments          Appointment[]
  serviceRecords        ServiceRecord[]
  serviceReminders      ServiceReminder[]
  largeAccount          LargeAccount?
  salesData             SalesData[]

  @@index([lastName, firstName])
  @@index([phone])
  @@map("customers")
}

model Vehicle {
  id            String    @id @default(cuid())
  customerId    String
  make          String    @db.VarChar(30)
  model         String    @db.VarChar(30)
  year          Int
  vin           String?   @unique @db.VarChar(17)
  licensePlate  String?   @db.VarChar(10)
  mileage       Int?
  tireSize      String?   @db.VarChar(20)
  notes         String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relationships
  customer         Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
  serviceRecords   ServiceRecord[]
  appointments     Appointment[]
  serviceReminders ServiceReminder[]

  @@index([customerId])
  @@index([customerId, make, model, year])
  @@map("vehicles")
}

model Employee {
  id           String        @id @default(cuid())
  firstName    String        @db.VarChar(50)
  lastName     String        @db.VarChar(50)
  email        String        @unique @db.VarChar(255)
  role         EmployeeRole
  employeeId   String        @unique @db.VarChar(20)
  hourlyRate   Decimal?      @db.Decimal(10, 2)
  hireDate     DateTime      @db.Date
  status       CustomerStatus @default(ACTIVE)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  // Relationships
  serviceRecords   ServiceRecord[]
  appointments     Appointment[]
  salesData        SalesData[]

  @@index([role])
  @@map("employees")
}

model ServiceRecord {
  id              String        @id @default(cuid())
  customerId      String
  vehicleId       String
  employeeId      String
  serviceMasterId String?       @db.VarChar(50)
  serviceDate     DateTime      @db.Date
  serviceType     String        @db.VarChar(100)
  description     String        @db.Text
  laborHours      Decimal       @db.Decimal(5, 2)
  partsCost       Decimal       @db.Decimal(10, 2)
  laborCost       Decimal       @db.Decimal(10, 2)
  taxAmount       Decimal?      @db.Decimal(10, 2)
  paymentStatus   PaymentStatus @default(PENDING)
  notes           String?       @db.Text
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relationships
  customer         Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
  vehicle          Vehicle           @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  employee         Employee          @relation(fields: [employeeId], references: [id])
  serviceReminders ServiceReminder[]
  salesData        SalesData[]

  @@index([customerId])
  @@index([vehicleId])
  @@index([employeeId])
  @@index([serviceDate, customerId])
  @@index([serviceMasterId])
  @@map("service_records")
}

model Appointment {
  id               String            @id @default(cuid())
  customerId       String
  vehicleId        String
  employeeId       String
  appointmentDate  DateTime          @db.Date
  appointmentTime  DateTime          @db.Time
  duration         Int               @default(60)
  serviceType      String            @db.VarChar(100)
  description      String?           @db.Text
  status           AppointmentStatus @default(SCHEDULED)
  reminderSent     Boolean           @default(false)
  confirmationSent Boolean           @default(false)
  notes            String?           @db.Text
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  // Relationships
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  vehicle  Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  employee Employee @relation(fields: [employeeId], references: [id])

  @@index([customerId])
  @@index([vehicleId])
  @@index([employeeId])
  @@index([appointmentDate, appointmentTime])
  @@index([employeeId, appointmentDate])
  @@map("appointments")
}

model ServiceReminder {
  id                  String              @id @default(cuid())
  customerId          String
  vehicleId           String
  lastServiceId       String?
  reminderType        String              @db.VarChar(50)
  reminderDate        DateTime            @db.Date
  reminderMessage     String              @db.Text
  sentDate            DateTime?           @db.Date
  status              ReminderStatus      @default(PENDING)
  communicationMethod CommunicationMethod @default(EMAIL)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  // Relationships
  customer    Customer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  vehicle     Vehicle        @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  lastService ServiceRecord? @relation(fields: [lastServiceId], references: [id])

  @@index([customerId])
  @@index([vehicleId])
  @@index([lastServiceId])
  @@index([reminderDate, status])
  @@index([status])
  @@map("service_reminders")
}

model LargeAccount {
  id                String              @id @default(cuid())
  customerId        String              @unique
  accountType       LargeAccountType
  tier              LargeAccountTier
  annualRevenue     Decimal?            @db.Decimal(12, 2)
  contractStartDate DateTime?           @db.Date
  contractEndDate   DateTime?           @db.Date
  status            LargeAccountStatus  @default(ACTIVE)
  accountManager    String              @db.VarChar(100)
  specialTerms      String?             @db.Text
  discountTier      Int?
  serviceLevel      ServiceLevel        @default(STANDARD)
  priorityRanking   Int?
  contractNumber    String?             @unique @db.VarChar(50)
  creditLimit       Decimal?            @db.Decimal(12, 2)
  paymentTerms      String?             @db.VarChar(50)
  billingContact    String?             @db.VarChar(100)
  billingEmail      String?             @db.VarChar(255)
  notes             String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relationships
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([tier])
  @@index([status])
  @@index([accountType])
  @@map("large_accounts")
}

model SalesData {
  id               String          @id @default(cuid())
  tireMasterId     String?         @db.VarChar(50)
  serviceRecordId  String?
  customerId       String?
  employeeId       String?
  invoiceId        String?
  sourceType       DataSourceType  @default(TIRE_MASTER_SYNC)
  transactionDate  DateTime        @db.Date
  transactionType  TransactionType @default(SALE)
  category         String          @db.VarChar(50)
  itemDescription  String          @db.VarChar(200)
  quantity         Decimal         @db.Decimal(10, 3)
  unitPrice        Decimal         @db.Decimal(10, 2)
  taxAmount        Decimal?        @db.Decimal(10, 2)
  grossProfitMargin Decimal?       @db.Decimal(5, 2)
  costBasis        Decimal?        @db.Decimal(10, 2)
  syncedAt         DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  // Relationships
  serviceRecord ServiceRecord? @relation(fields: [serviceRecordId], references: [id])
  customer      Customer?      @relation(fields: [customerId], references: [id])
  employee      Employee?      @relation(fields: [employeeId], references: [id])
  invoice       Invoice?       @relation(fields: [invoiceId], references: [id])

  @@unique([tireMasterId], name: "unique_tire_master_id")
  @@index([serviceRecordId])
  @@index([customerId])
  @@index([employeeId])
  @@index([invoiceId])
  @@index([sourceType])
  @@index([transactionDate, category])
  @@index([transactionType])
  @@map("sales_data")
}

// Invoice CSV Import Models

model InvoiceCustomer {
  id           String   @id @default(cuid())
  name         String   @db.VarChar(255)
  email        String?  @db.VarChar(255)
  phone        String?  @db.VarChar(50)
  address      String?  @db.Text
  customerCode String?  @db.VarChar(100)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relationships
  invoices    Invoice[]

  @@unique([name], name: "unique_invoice_customer_name")
  @@map("invoice_customers")
}

model Invoice {
  id              String        @id @default(cuid())
  invoiceNumber   String        @unique @map("invoice_number") @db.VarChar(50)
  customerId      String        @map("customer_id")
  invoiceDate     DateTime      @map("invoice_date")
  salesperson     String        @db.VarChar(255)
  vehicleInfo     String?       @map("vehicle_info") @db.VarChar(255)
  mileage         String?       @db.VarChar(50)
  subtotal        Decimal       @db.Decimal(10, 2)
  taxAmount       Decimal       @map("tax_amount") @db.Decimal(10, 2)
  totalAmount     Decimal       @map("total_amount") @db.Decimal(10, 2)
  laborCost       Decimal?      @map("labor_cost") @db.Decimal(10, 2)
  partsCost       Decimal?      @map("parts_cost") @db.Decimal(10, 2)
  fetTotal        Decimal?      @map("fet_total") @db.Decimal(10, 2)
  environmentalFee Decimal?     @map("environmental_fee") @db.Decimal(10, 2)
  totalCost       Decimal?      @map("total_cost") @db.Decimal(10, 2)
  grossProfit     Decimal?      @map("gross_profit") @db.Decimal(10, 2)
  status          InvoiceStatus @default(ACTIVE)
  importBatchId   String        @map("import_batch_id")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  storeId         String?       @map("store_id")
  store           Store?        @relation(fields: [storeId], references: [id])

  // Relationships
  customer     InvoiceCustomer   @relation(fields: [customerId], references: [id])
  lineItems    InvoiceLineItem[]
  importBatch  ImportBatch       @relation(fields: [importBatchId], references: [id])
  salesData    SalesData[]
  reconciliationRecords ReconciliationRecord[]

  @@index([invoiceDate])
  @@index([customerId])
  @@index([importBatchId])
  @@index([salesperson])
  @@index([storeId])
  @@map("invoices")
}

model Store {
  id          String    @id @default(cuid())
  code        String    @unique @db.VarChar(10)
  name        String    @db.VarChar(100)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  invoices    Invoice[]

  @@map("stores")
}

model InvoiceLineItem {
  id                  String          @id @default(cuid())
  invoiceId           String          @map("invoice_id")
  lineNumber          Int?            @map("line_number")
  productCode         String          @map("product_code") @db.VarChar(100)
  description         String          @db.Text
  adjustment          String?         @db.VarChar(50)
  quantity            Decimal         @db.Decimal(10, 3)
  partsCost           Decimal         @map("parts_cost") @db.Decimal(10, 2)
  laborCost           Decimal         @map("labor_cost") @db.Decimal(10, 2)
  fet                 Decimal         @db.Decimal(10, 2)
  lineTotal           Decimal         @map("line_total") @db.Decimal(10, 2)
  costPrice           Decimal         @map("cost_price") @db.Decimal(10, 2)
  grossProfitMargin   Decimal         @map("gross_profit_margin") @db.Decimal(5, 2)
  grossProfit         Decimal         @map("gross_profit") @db.Decimal(10, 2)
  category            ProductCategory
  tireMasterProductId String?         @map("tire_master_product_id")
  createdAt           DateTime        @default(now()) @map("created_at")

  // Relationships
  invoice           Invoice            @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  tireMasterProduct TireMasterProduct? @relation(fields: [tireMasterProductId], references: [id])

  @@index([invoiceId])
  @@index([productCode])
  @@index([category])
  @@index([tireMasterProductId])
  @@map("invoice_line_items")
}

model ImportBatch {
  id                String       @id @default(cuid())
  fileName          String       @map("file_name") @db.VarChar(255)
  originalPath      String       @map("original_path") @db.VarChar(500)
  processedPath     String?      @map("processed_path") @db.VarChar(500)
  startedAt         DateTime     @default(now()) @map("started_at")
  completedAt       DateTime?    @map("completed_at")
  totalRecords      Int          @map("total_records")
  successfulRecords Int          @default(0) @map("successful_records")
  failedRecords     Int          @default(0) @map("failed_records")
  status            ImportStatus @default(STARTED)
  userId            String?      @map("user_id") @db.VarChar(100)
  errorSummary      String?      @map("error_summary") @db.Text

  // Relationships
  invoices           Invoice[]
  errors             ImportError[]
  rollbackOperations ImportRollbackOperation[]

  @@index([startedAt])
  @@index([status])
  @@map("import_batches")
}

model ImportError {
  id             String    @id @default(cuid())
  importBatchId  String    @map("import_batch_id")
  rowNumber      Int       @map("row_number")
  errorType      ErrorType @map("error_type")
  errorMessage   String    @map("error_message") @db.Text
  originalData   String    @map("original_data") @db.Text
  fieldName      String?   @map("field_name") @db.VarChar(100)
  createdAt      DateTime  @default(now()) @map("created_at")

  // Relationships
  importBatch ImportBatch @relation(fields: [importBatchId], references: [id])

  @@index([importBatchId])
  @@index([errorType])
  @@map("import_errors")
}

model ImportRollbackOperation {
  id              String   @id @default(cuid())
  importBatchId   String   @map("import_batch_id")
  operationType   String   @map("operation_type") @db.VarChar(50)
  recordId        String   @map("record_id") @db.VarChar(100)
  tableName       String   @map("table_name") @db.VarChar(100)
  operation       String   @db.VarChar(20)
  originalData    String?  @map("original_data") @db.Text
  newData         String?  @map("new_data") @db.Text
  timestamp       DateTime @default(now())

  // Relationships
  importBatch ImportBatch @relation(fields: [importBatchId], references: [id])

  @@index([importBatchId])
  @@index([operationType])
  @@index([tableName])
  @@index([timestamp])
  @@map("import_rollback_operations")
}

// Tire Master Integration Models

enum TireType {
  PASSENGER
  LIGHT_TRUCK
  MEDIUM_TRUCK
  INDUSTRIAL
  AGRICULTURAL
  OTR
  TRAILER
  ATV_UTV
  LAWN_GARDEN
  COMMERCIAL
  SPECIALTY
  OTHER
}

enum TireSeason {
  ALL_SEASON
  SUMMER
  WINTER
}

enum TireQuality {
  PREMIUM
  STANDARD
  ECONOMY
  UNKNOWN
}

enum SyncStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum InvoiceStatus {
  ACTIVE
  VOIDED
  RETURNED
}

enum ProductCategory {
  TIRES
  SERVICES
  PARTS
  FEES
  OTHER
}

enum ImportStatus {
  STARTED
  IN_PROGRESS
  COMPLETED
  FAILED
  ROLLED_BACK
}

enum ErrorType {
  VALIDATION
  DUPLICATE
  MISSING_DATA
  FORMAT
  BUSINESS_RULE
}

enum DataSourceType {
  TIRE_MASTER_SYNC
  INVOICE_IMPORT
}

enum MappingType {
  EXACT
  EQUIVALENT
  SUBSTITUTE
}

model TireMasterProduct {
  id               String                       @id @default(cuid())
  tireMasterSku    String                       @unique @db.VarChar(50)
  brand            String                       @db.VarChar(100)
  pattern          String                       @db.VarChar(100)
  size             String                       @db.VarChar(50)
  type             TireType
  season           TireSeason
  quality          TireQuality                  @default(UNKNOWN)
  description      String?                      @db.Text
  weight           Decimal?                     @db.Decimal(8, 2)
  laborPrice       Decimal?                     @map("labor_price") @db.Decimal(10, 2)
  fetAmount        Decimal?                     @map("fet_amount") @db.Decimal(10, 2)
  specifications   Json?
  warrantyInfo     String?                      @db.Text
  features         String[]
  manufacturerCode String?                      @map("manufacturer_code") @db.VarChar(50)
  isTire           Boolean                      @default(false)
  isActive         Boolean                      @default(true)
  lastSyncedAt     DateTime?
  createdAt        DateTime                     @default(now())
  updatedAt        DateTime                     @updatedAt

  // Relationships
  inventory        TireMasterInventory[]
  prices           TireMasterPrice[]
  orderItems       TireMasterSalesOrderItem[]
  mappings         TireMasterProductMapping[]
  invoiceLineItems InvoiceLineItem[]

  @@index([brand])
  @@index([size])
  @@index([type])
  @@index([season])
  @@index([isActive])
  @@index([lastSyncedAt])
  @@map("tire_master_products")
}

model TireMasterLocation {
  id              String                  @id @default(cuid())
  tireMasterCode  String                  @unique @db.VarChar(20)
  name            String                  @db.VarChar(100)
  address         String?                 @db.VarChar(200)
  city            String?                 @db.VarChar(50)
  state           String?                 @db.VarChar(20)
  zipCode         String?                 @db.VarChar(10)
  phone           String?                 @db.VarChar(20)
  isActive        Boolean                 @default(true)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  // Relationships
  inventory       TireMasterInventory[]

  @@index([tireMasterCode])
  @@index([isActive])
  @@map("tire_master_locations")
}

model TireMasterInventory {
  id             String               @id @default(cuid())
  productId      String
  locationId     String
  quantity       Int                  @default(0)
  reservedQty    Int                  @default(0)
  availableQty   Int                  @default(0)
  lastUpdated    DateTime             @default(now())
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  // Relationships
  product        TireMasterProduct    @relation(fields: [productId], references: [id], onDelete: Cascade)
  location       TireMasterLocation   @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([productId, locationId])
  @@index([productId])
  @@index([locationId])
  @@index([quantity])
  @@index([lastUpdated])
  @@map("tire_master_inventory")
}

model TireMasterPriceList {
  id              String              @id @default(cuid())
  tireMasterCode  String              @unique @db.VarChar(20)
  name            String              @db.VarChar(100)
  description     String?             @db.Text
  currency        String              @default("USD") @db.VarChar(3)
  effectiveDate   DateTime?           @db.Date
  expirationDate  DateTime?           @db.Date
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relationships
  prices          TireMasterPrice[]

  @@index([tireMasterCode])
  @@index([isActive])
  @@index([effectiveDate])
  @@map("tire_master_price_lists")
}

model TireMasterPrice {
  id              String                @id @default(cuid())
  productId       String
  priceListId     String
  listPrice       Decimal               @db.Decimal(10, 2)
  cost            Decimal?              @db.Decimal(10, 2)
  msrp            Decimal?              @db.Decimal(10, 2)
  effectiveDate   DateTime?             @db.Date
  expirationDate  DateTime?             @db.Date
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  // Relationships
  product         TireMasterProduct     @relation(fields: [productId], references: [id], onDelete: Cascade)
  priceList       TireMasterPriceList   @relation(fields: [priceListId], references: [id], onDelete: Cascade)

  @@unique([productId, priceListId])
  @@index([productId])
  @@index([priceListId])
  @@index([effectiveDate])
  @@map("tire_master_prices")
}

model TireMasterCustomer {
  id                String                     @id @default(cuid())
  tireMasterCode    String                     @unique @db.VarChar(50)
  companyName       String?                    @db.VarChar(100)
  firstName         String?                    @db.VarChar(50)
  lastName          String?                    @db.VarChar(50)
  email             String?                    @db.VarChar(255)
  phone             String?                    @db.VarChar(20)
  address           String?                    @db.VarChar(200)
  city              String?                    @db.VarChar(50)
  state             String?                    @db.VarChar(20)
  zipCode           String?                    @db.VarChar(10)
  creditLimit       Decimal?                   @db.Decimal(12, 2)
  paymentTerms      String?                    @db.VarChar(50)
  isActive          Boolean                    @default(true)
  lastSyncedAt      DateTime?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt

  // Relationships
  salesOrders       TireMasterSalesOrder[]

  @@index([tireMasterCode])
  @@index([companyName])
  @@index([isActive])
  @@index([lastSyncedAt])
  @@map("tire_master_customers")
}

model TireMasterSalesOrder {
  id              String                        @id @default(cuid())
  tireMasterCode  String                        @unique @db.VarChar(50)
  customerId      String
  orderNumber     String                        @db.VarChar(50)
  orderDate       DateTime                      @db.Date
  requiredDate    DateTime?                     @db.Date
  shippedDate     DateTime?                     @db.Date
  status          String                        @db.VarChar(50)
  subtotal        Decimal                       @db.Decimal(12, 2)
  taxAmount       Decimal?                      @db.Decimal(10, 2)
  shippingAmount  Decimal?                      @db.Decimal(10, 2)
  totalAmount     Decimal                       @db.Decimal(12, 2)
  notes           String?                       @db.Text
  lastSyncedAt    DateTime?
  createdAt       DateTime                      @default(now())
  updatedAt       DateTime                      @updatedAt

  // Relationships
  customer        TireMasterCustomer            @relation(fields: [customerId], references: [id], onDelete: Cascade)
  items           TireMasterSalesOrderItem[]

  @@index([tireMasterCode])
  @@index([customerId])
  @@index([orderDate])
  @@index([status])
  @@index([lastSyncedAt])
  @@map("tire_master_sales_orders")
}

model TireMasterSalesOrderItem {
  id              String                @id @default(cuid())
  salesOrderId    String
  productId       String
  lineNumber      Int
  quantity        Int
  unitPrice       Decimal               @db.Decimal(10, 2)
  discount        Decimal?              @db.Decimal(10, 2)
  totalAmount     Decimal               @db.Decimal(12, 2)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  // Relationships
  salesOrder      TireMasterSalesOrder  @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)
  product         TireMasterProduct     @relation(fields: [productId], references: [id])

  @@unique([salesOrderId, lineNumber])
  @@index([salesOrderId])
  @@index([productId])
  @@map("tire_master_sales_order_items")
}

model TireMasterProductMapping {
  id                   String              @id @default(cuid())
  tireMasterProductId  String
  crmProductId         String?
  mappingType          MappingType
  autoSync             Boolean             @default(true)
  notes                String?             @db.Text
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt

  // Relationships
  tireMasterProduct    TireMasterProduct   @relation(fields: [tireMasterProductId], references: [id], onDelete: Cascade)
  // Note: crmProductId references external CRM system product ID
  // Actual relationship would be established when CRM product model is available

  @@unique([tireMasterProductId, crmProductId])
  @@index([tireMasterProductId])
  @@index([crmProductId])
  @@index([mappingType])
  @@index([autoSync])
  @@map("tire_master_product_mappings")
}

model TireMasterSyncHistory {
  id                String        @id @default(cuid())
  syncId            String        @unique @db.VarChar(100)
  syncType          String        @db.VarChar(50)
  status            SyncStatus
  startTime         DateTime
  endTime           DateTime?
  recordsProcessed  Int           @default(0)
  recordsCreated    Int           @default(0)
  recordsUpdated    Int           @default(0)
  recordsFailed     Int           @default(0)
  errors            String[]
  metadata          Json?
  createdAt         DateTime      @default(now())

  @@index([syncId])
  @@index([syncType])
  @@index([status])
  @@index([startTime])
  @@map("tire_master_sync_history")
}
// National Account Reconciliation Models

model ReconciliationBatch {
  id          String   @id @default(cuid())
  filename    String
  uploadDate  DateTime @default(now())
  status      String   // PENDING, PROCESSED, COMPLETED
  totalRecords Int     @default(0)
  matchedCount Int     @default(0)
  unmatchedCount Int   @default(0)
  
  records     ReconciliationRecord[]
  
  @@map("reconciliation_batches")
}

model ReconciliationRecord {
  id              String   @id @default(cuid())
  batchId         String
  
  // Fields from CSV
  invoiceNumber   String   // The raw invoice number from CSV
  accountName     String?  // "Account Name"
  invoiceDate     DateTime?
  invoiceAmount   Decimal  @db.Decimal(10, 2) // "Invoice Amt"
  creditAmount    Decimal  @db.Decimal(10, 2) // "CR Amount"
  commission      Decimal  @db.Decimal(10, 2) // "CR Comm"
  difference      Decimal  @db.Decimal(10, 2) // "Difference"
  
  // Categorization
  category        String?  // "Government Support", "Other Adjustments", etc.
  subCategory     String?  // "Bridgestone", "Firestone", etc.
  
  // Matching
  status          String   // MATCHED, UNMATCHED, PARTIAL, OVERPAID
  matchedInvoiceId String?
  
  // Relationships
  batch           ReconciliationBatch @relation(fields: [batchId], references: [id])
  matchedInvoice  Invoice?            @relation(fields: [matchedInvoiceId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([batchId])
  @@index([invoiceNumber])
  @@index([status])
  @@map("reconciliation_records")
}

model MechanicLabor {
  id            String   @id @default(cuid())
  mechanicName  String   @map("mechanic_name")
  category      String
  invoiceNumber String   @map("invoice_number")
  productCode   String   @map("product_code")
  quantity      Decimal  @db.Decimal(10, 2)
  parts         Decimal  @db.Decimal(10, 2)
  labor         Decimal  @db.Decimal(10, 2)
  totalCost     Decimal  @map("total_cost") @db.Decimal(10, 2)
  grossProfit   Decimal  @map("gross_profit") @db.Decimal(10, 2)
  gpPercent     Decimal  @map("gp_percent") @db.Decimal(10, 2)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("mechanic_labor")
}

